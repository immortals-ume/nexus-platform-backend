spring:
  application:
    name: otp-service
  profiles:
    active: prometheus
  
  # Redis configuration
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 2
        max-wait: -1ms

# Platform cache-starter configuration
platform:
  cache:
    # Multi-level caching (L1: Caffeine, L2: Redis)
    multi-level:
      enabled: true
      l1:
        provider: caffeine
        max-size: 1000
        ttl: 2m
        eviction-policy: LRU
      l2:
        provider: redis
        ttl: 5m
        compression:
          enabled: true
          threshold: 1KB
    
    # Namespace configuration for OTP service
    namespaces:
      - name: otp-sms
        prefix: "otp:sms:"
        description: "SMS OTP codes"
      - name: otp-rate-limit
        prefix: "otp:rate:"
        description: "OTP rate limiting"
    
    # Circuit breaker for Redis
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      slow-call-rate-threshold: 50
      slow-call-duration-threshold: 2s
      wait-duration-in-open-state: 10s
    
    # Statistics and metrics
    statistics:
      enabled: true
      export-to-prometheus: true
      time-windows:
        - ONE_MINUTE
        - FIVE_MINUTES
        - FIFTEEN_MINUTES
        - ONE_HOUR

# Actuator endpoints for monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,cache-statistics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
    prometheus:
      enabled: true
    cache-statistics:
      enabled: true
  
  # Metrics configuration
  metrics:
    export:
      prometheus:
        enabled: true
        step: 1m
        descriptions: true
    distribution:
      percentiles-histogram:
        cache.operation.duration: true
        cache.namespace.operation.duration: true
        cache.stampede.protection.lock_wait_time: true
        cache.stampede.protection.computation_time: true
      percentiles:
        cache.operation.duration: 0.5, 0.95, 0.99
        cache.namespace.operation.duration: 0.5, 0.95, 0.99
    tags:
      application: ${spring.application.name}
      environment: ${ENVIRONMENT:dev}
      service: otp-service

# Server configuration
server:
  port: ${SERVER_PORT:8080}
  shutdown: graceful

# Logging
logging:
  level:
    com.immortals.otpservice: INFO
    com.immortals.cacheservice: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
